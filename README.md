# Flight Agent Starter (FastAPI)

This is a minimal starter for an automated flight tracker agent with:
- **Watches** to monitor routes/dates
- **Typical price** lookup (Amadeus stub with real integration points)
- **Live offers** & **booking** (Duffel stub with real integration points)
- A basic **rule engine** for `auto_book` and `confirm_price` flows
- FastAPI endpoints + SQLite storage (SQLAlchemy)

> ⚠️ **APIs:** Google Flights has no official public API. This starter uses Amadeus (price analytics) and Duffel (shopping/booking) integration points. Update `services/providers.py` with your credentials and uncomment the real calls.

---

## Quick start

```bash
# 1) Create a venv
python -m venv .venv && source .venv/bin/activate

# 2) Install deps
pip install -r requirements.txt

# 3) Set env (example; use real keys in production)
export AMADEUS_CLIENT_ID=your_id
export AMADEUS_CLIENT_SECRET=your_secret
export DUFFEL_ACCESS_TOKEN=duffel_test_xxx
export TIMEZONE=America/Los_Angeles

# 4) Run API
uvicorn app.main:app --reload
```

Go to `http://127.0.0.1:8000/docs` for interactive Swagger.

---

## Data model (simplified)

- `Watch`: what to track (OD, dates, pax, cabin, thresholds)
- `PriceSnapshot`: periodic price readings (from provider searches)
- `TypicalPrice`: stored quartiles for OD+date (p10/p25/p50/p75)
- `Alert`: messages generated by rules
- `Order`: booking/hold status

---

## Endpoints (MVP)

- `POST /watch` — create a watch
- `GET  /watch` — list watches
- `POST /tick` — run one polling cycle (fetch typical + live offers, evaluate rules)
- `GET  /alerts` — list alerts (optionally by watch_id)
- `POST /book/confirm` — confirm a pending alert to book now

> In production you'd schedule `/tick` on a cron or queue worker.

---

## Where to plug real providers

Open `app/services/providers.py`. You’ll find:
- `get_typical_price_amadeus(...)`
- `search_live_offers_duffel(...)`
- `book_with_duffel(...)`

They have **mock fallbacks** so you can run the demo immediately. Uncomment the real SDK calls once keys are set.

---

## Next steps

- Add auth & multi‑user tenancy
- Add SMS/Email notifications (Twilio/SendGrid)
- Add cabin‑specific typicals and ±3d flex windows
- Persist provider raw blobs for auditability
- Harden booking: re‑price just‑in‑time, seat/baggage rules, refundability flags
- Add a tiny web UI for managing watches

Enjoy!
